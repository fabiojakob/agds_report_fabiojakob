---
title: "re_stepwise"
author: "Fabio Jakob 20-107-876"
date: "2023-04-17"
output: html_document
---
```{r}
library(readr)
df_for_stepwise_regression <- read_csv('C:/Users/fabio.LAPTOP-FR4VQFHF/Documents/agds_report_fabiojakob/Data/df_for_stepwise_regression.csv')
View(df_for_stepwise_regression)
```
manual implementation of stepwise forward regression:

Define the response variable and predictor variables
```{r}
response <- "GPP_NT_VUT_REF"
predictors <- c("siteid", "TIMESTAMP", "TA_F", "SW_IN_F", "LW_IN_F", "VPD_F", "PA_F", "P_F", "WS_F", "TA_F_MDS", "SW_IN_F_MDS", "LW_IN_F_MDS", "VPD_F_MDS", "CO2_F_MDS", "PPFD_IN", "USTAR")
```

Initialize an empty vector to store the selected predictors
```{r}
selected <- c()
```

Set the significance level for adding predictors to the model
```{r}
alpha <- 0.05
```

Run the regression
```{r}
while (length(predictors) > 0) {
  # Initialize a vector to store the p-values for each predictor
  p <- rep(NA, length(predictors))
  
  # Fit a linear regression model with each predictor added one at a time
  for (i in 1:length(predictors)) {
    formula <- paste(response, paste(c(selected, predictors[i]), collapse = "+"), sep = "~")
    model <- lm(formula, df_for_stepwise_regression)
    p[i] <- summary(model)$coef[2, 4]
  }
  
  # Find the predictor with the lowest p-value
  min_p <- min(p)
  min_index <- which(p == min_p)
  best_predictor <- predictors[min_index]
  
  # Add the best predictor to the selected list
  selected <- c(selected, best_predictor)
  
  # Remove the best predictor from the list of predictors
  predictors <- predictors[-min_index]
  
  # Check if the best predictor is significant enough to keep in the model
  if (min_p < alpha) {
    cat(paste("Added", best_predictor, "to the model.\n"))
  } else {
    cat(paste("Stopped the algorithm. No more predictors are significant.\n"))
    break
  }
}
```

Fit a final linear regression model with the selected predictors
```{r}
formula <- paste(response, paste(selected, collapse = "+"), sep = "~")
model <- lm(formula, df_for_stepwise_regression)
```

Print the final model summary
```{r}
summary(model)
```


```{r}
library(ggplot2)
library(ggpubr)
library(ggcorrplot)

df_for_stepwise_regression <- na.omit(df_for_stepwise_regression)

data <- data.frame(x1 = df_for_stepwise_regression$TA_F, x2 = df_for_stepwise_regression$SW_IN_F, x3 = df_for_stepwise_regression$LW_IN_F, x4 = df_for_stepwise_regression$VPD_F, x5 = df_for_stepwise_regression$TA_F_MDS,
                    x6 = df_for_stepwise_regression$SW_IN_F_MDS, x7 = df_for_stepwise_regression$VPD_F_MDS, x8 = df_for_stepwise_regression$PPFD_IN, y = df_for_stepwise_regression$GPP_NT_VUT_REF)

corr <- cor(data)


ggcorrplot(corr, hc.order = TRUE, type = "upper", colors = c("#6D9EC1", "white", "#E46726"), lab = TRUE)

```
```{r}
library(GGally)
ggparcoord(data, columns = 1:8, groupColumn = "y")
```
```{r}
install.packages("caret")
```

```{r}
library(caret)

model <- train(y ~ ., data = data, method = "lm")

varImpPlot(model)
```









Empty Model:
```{r}
start <- lm(GPP_NT_VUT_REF ~ 1, data = df_for_stepwise_regression)
head(df_for_stepwise_regression)
```


```{r}
all <- lm(GPP_NT_VUT_REF ~ ., data = df_for_stepwise_regression)
step(start, direction = "forward", scope = formula(all))
```
```{r}
library(ggplot2)
ggplot(data = df_for_stepwise_regression)+ geom_point(aes(x = TIMESTAMP, y = GPP_NT_VUT_REF))
```

```{r}
final_model <- lm(formula = GPP_NT_VUT_REF ~ PPFD_IN + siteid + LW_IN_F + VPD_F_MDS + 
    TA_F_MDS + SW_IN_F + WS_F + USTAR + VPD_F + CO2_F_MDS + PA_F + 
    TIMESTAMP + P_F, data = df_for_stepwise_regression)
summary(final_model)
```






